# PiTrac Configuration
# This file contains all PiTrac settings - both basic and advanced
# 
# Basic settings are commonly adjusted parameters
# Advanced settings (below the separator) are for fine-tuning
#
# Settings here override defaults in golf_sim_config.json when uncommented.

version: 2.0

# ============================================================================
# BASIC SETTINGS - Commonly adjusted parameters
# ============================================================================

# ----------------------------------------------------------------------------
# SYSTEM MODE
# ----------------------------------------------------------------------------

system:
  # Camera setup mode (single or dual Pi setup)
  # mode: single              # Options: single, dual
  
  # Camera role (only for dual mode)
  # camera_role: camera1      # Options: camera1, camera2
  
  # Golfer orientation
  # golfer_orientation: right_handed  # Options: right_handed, left_handed
  
  # Start in putting mode
  # putting_mode: false       # Maps to gs_config.modes.kStartInPuttingMode

# ----------------------------------------------------------------------------
# CAMERA HARDWARE
# ----------------------------------------------------------------------------

cameras:
  # Camera hardware types - Set via environment variables  
  # Note: These are passed as PITRAC_SLOT1_CAMERA_TYPE environment variables
  slot1:
    type: 4  # 1=PiCam1.3, 2=PiCam2, 3=PiHQ, 4=PiGS, 5=InnoMaker
    lens: 1  # 1=6mm, 2=3.6mm_M12 (optional, defaults to 1)
  slot2:
    type: 4  # 1=PiCam1.3, 2=PiCam2, 3=PiHQ, 4=PiGS, 5=InnoMaker
    lens: 1  # 1=6mm, 2=3.6mm_M12 (optional, defaults to 1)
  
  # Camera gain (brightness) settings - Override JSON defaults
  # camera1_gain: 1.0         # Maps to gs_config.cameras.kCamera1Gain (0.5-16.0)
  # camera2_gain: 4.0         # Maps to gs_config.cameras.kCamera2Gain (0.5-16.0)

# ----------------------------------------------------------------------------
# SIMULATOR INTERFACES
# ----------------------------------------------------------------------------

simulators:
  # E6 Connect Settings
  # e6_host: ""               # Maps to gs_config.golf_simulator_interfaces.E6.kE6ConnectAddress
  # e6_port: 2483             # Maps to gs_config.golf_simulator_interfaces.E6.kE6ConnectPort
  
  # GSPro Settings  
  # gspro_host: ""            # Maps to gs_config.golf_simulator_interfaces.GSPro.kGSProConnectAddress
  # gspro_port: 921           # Maps to gs_config.golf_simulator_interfaces.GSPro.kGSProConnectPort

# ----------------------------------------------------------------------------
# BALL DETECTION
# ----------------------------------------------------------------------------

ball_detection:
  # Detection method
  # method: "legacy"          # Options: legacy, experimental, experimental_sahi
                              # - legacy: HoughCircles (most stable)
                              # - experimental: YOLO neural network
                              # - experimental_sahi: YOLO with SAHI slicing
  
  # Contrast enhancement
  # use_clahe: true           # Maps to gs_config.ball_identification.kUseCLAHEProcessing
  # clahe_clip_limit: 8       # Maps to gs_config.ball_identification.kCLAHEClipLimit (1-40)
  
  # Expected ball size (critical for distance calculations)
  # ball_radius_pixels: 87    # Maps to gs_config.ball_position.kExpectedBallRadiusPixelsAt40cm

# ----------------------------------------------------------------------------
# STROBING (LED TIMING)
# ----------------------------------------------------------------------------

strobing:
  # Ball speed adjustments
  # standard_speed_adjustment: 0.1    # Standard balls (0.0-10.0%)
  # practice_speed_adjustment: 4.0    # Practice balls (0.0-20.0%)
  # putting_speed_adjustment: 5.2     # Putting mode (0.0-20.0%)

# ----------------------------------------------------------------------------
# DATA STORAGE
# ----------------------------------------------------------------------------

storage:
  # Image logging options
  # log_exposure_images: true         # Save intermediate exposure images
  # log_spin_images: true             # Save spin analysis images
  # log_webserver_images: true        # Save web server images
  # unique_diagnostic_files: true     # Use unique filenames (false = overwrite)
  
  # Directory paths
  # image_dir: "~/LM_Shares/Images/"      # Image logging directory
  # web_share_dir: "~/LM_Shares/WebShare/" # Web share directory

# ----------------------------------------------------------------------------
# NETWORK SETTINGS
# ----------------------------------------------------------------------------

network:
  # ActiveMQ broker (for dual camera mode)
  # broker_address: "tcp://localhost:61616"
  
  # Web interface
  # web_refresh_seconds: 3    # Refresh interval (1-60 seconds)

# ----------------------------------------------------------------------------
# SPIN CALCULATION
# ----------------------------------------------------------------------------

spin:
  # skip_calculation: false   # Set to true for putting-only or debugging
  # write_csv_files: true     # Write spin analysis CSV files


# ╔══════════════════════════════════════════════════════════════════════════╗
# ║                         ADVANCED SETTINGS                                ║
# ║                                                                          ║
# ║  WARNING: Modify these only if you understand the implications.         ║
# ║  These settings can significantly affect ball detection accuracy.       ║
# ╚══════════════════════════════════════════════════════════════════════════╝


# ----------------------------------------------------------------------------
# HOUGH CIRCLES BALL DETECTION (LEGACY MODE)
# ----------------------------------------------------------------------------

ball_detection_advanced:
  strobed_balls:
    # Canny edge detection thresholds
    # canny_lower: 33          # Maps to gs_config.ball_identification.kStrobedBallsCannyLower (0-255)
    # canny_upper: 90          # Maps to gs_config.ball_identification.kStrobedBallsCannyUpper (0-255)
    
    # Circle detection limits
    # min_circles: 6           # Maps to gs_config.ball_identification.kStrobedBallsMinHoughReturnCircles
    # max_circles: 20          # Maps to gs_config.ball_identification.kStrobedBallsMaxHoughReturnCircles
    
    # HoughCircles parameters
    # param1: 300              # Gradient threshold (1-500)
    # param2_min: 11           # Min accumulator threshold (1-200)
    # param2_max: 55           # Max accumulator threshold (1-300)
    # dp: 1.0                  # Distance parameter (0.5-3.0)
    
    # Blur kernel sizes
    # pre_canny_blur: 1        # Options: 1, 3, 5, 7, 9
    # pre_hough_blur: 1        # Options: 1, 3, 5, 7, 9
  
  # Alternative algorithm settings
  alternative_algorithm:
    # enabled: false           # Enable alternative Hough algorithm
    # min_radius_multiplier: 0.53  # Min radius multiplier (0.1-2.0)
    # max_radius_multiplier: 1.87  # Max radius multiplier (0.5-5.0)
  
  # Putting mode specific
  putting_mode:
    # param1: 300              # Param1 for putting (50-500)
    # param2: 18               # Param2 for putting (5-50)
    # pre_canny_blur: 3        # Pre-Canny blur for putting

# ----------------------------------------------------------------------------
# AI DETECTION SETTINGS (EXPERIMENTAL MODE)
# ----------------------------------------------------------------------------

ai_detection:
  # YOLO model configuration
  # model_path: "../../Software/GroundTruthAnnotator/experiments/high_performance_300e2/weights/best.onnx"
  # confidence_threshold: 0.5  # Maps to gs_config.ball_identification.kONNXConfidenceThreshold
  # nms_threshold: 0.4         # Maps to gs_config.ball_identification.kONNXNMSThreshold
  # input_size: 1472           # Maps to gs_config.ball_identification.kONNXInputSize

# ----------------------------------------------------------------------------
# EXPOSURE SELECTION
# ----------------------------------------------------------------------------

exposure_selection:
  # high_quality_balls: 2     # Number of high-quality balls to identify (1-10)
  # max_balls: 30             # Maximum balls to process (10-100)
  # min_ball_radius: 30       # Minimum ball radius in pixels (10-100)
  # max_ball_radius: 200      # Maximum ball radius in pixels (50-500)

# ----------------------------------------------------------------------------
# SPIN ANALYSIS ADVANCED
# ----------------------------------------------------------------------------

spin_analysis_advanced:
  # SIFT feature detection
  sift:
    # n_features: 1000        # Number of features (100-5000)
    # n_octave_layers: 3      # Octave layers (1-10)
    # contrast_threshold: 0.04 # Contrast threshold (0.01-0.1)
    # edge_threshold: 10      # Edge threshold (5-50)
    # sigma: 1.6              # Sigma value (0.5-3.0)
  
  # Feature matching
  matching:
    # flann_trees: 5          # FLANN matcher trees (1-10)
    # flann_checks: 50        # FLANN checks (10-200)
    # good_match_ratio: 0.7   # Good match ratio (0.5-0.9)

# ----------------------------------------------------------------------------
# CALIBRATION SETTINGS
# ----------------------------------------------------------------------------

calibration_advanced:
  checkerboard:
    # corners_width: 9        # Inner corners width
    # corners_height: 6       # Inner corners height
    # square_size: 25.0       # Square size in mm
    # subpix_window: 11       # Subpixel window size
    # subpix_iterations: 30   # Subpixel iterations

# ----------------------------------------------------------------------------
# PERFORMANCE TUNING
# ----------------------------------------------------------------------------

performance:
  # processing_threads: 4     # Number of threads (1-16)
  # image_buffer_size: 100    # Buffer size (10-1000)
  # gpu_acceleration: false   # Enable GPU if available
  # cache_size_mb: 512        # Memory cache size (100-4000 MB)

# ----------------------------------------------------------------------------
# DIAGNOSTIC SETTINGS
# ----------------------------------------------------------------------------

diagnostics:
  # verbose_logging: false    # Enable verbose logging
  # log_level: info          # Options: debug, info, warning, error
  # save_diagnostic_frames: false  # Save diagnostic frames
  # diagnostic_frame_interval: 10  # Frame save interval (1-100)

# ============================================================================
# NOTES
# ============================================================================
# 
# 1. Camera slot types (slot1/slot2) are active by default and passed as 
#    environment variables to the binary (not JSON overrides)
# 2. All other commented settings override JSON values when uncommented
# 3. To activate a setting, remove the # at the beginning of the line
# 4. For complete parameter documentation, see:
#    - /etc/pitrac/config/parameter-mappings.yaml (all mappings)
#    - /etc/pitrac/config/README.md (detailed documentation)
#    - /etc/pitrac/golf_sim_config.json (JSON defaults)