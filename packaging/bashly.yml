name: pitrac
help: PiTrac Golf Launch Monitor CLI
version: 1.0.0

# Global environment variables
environment_variables:
  - name: PITRAC_HOME
    help: PiTrac home directory
    default: ${HOME}/.pitrac

# Global flags available to all commands
flags:
  - long: --verbose
    short: -v
    help: Enable verbose output (info level)
  - long: --info
    short: -i
    help: Enable info level output
  - long: --debug
    short: -d
    help: Enable debug level output
  - long: --trace
    short: -t
    help: Enable trace level output (most verbose)

commands:
  # Main operational commands
  - name: run
    help: Start PiTrac launch monitor
    examples:
      - pitrac run
      - pitrac run --foreground
      - pitrac run --system-mode camera2
    flags:
      - long: --foreground
        short: -f
        help: Run in foreground (don't daemonize)
      - long: --system-mode
        arg: mode
        help: Override system mode from config
        allowed: [camera1, camera2]
      - long: --msg-broker-address
        arg: address
        help: "Override message broker address (e.g., tcp://10.0.0.41:61616)"
      - long: --base-image-logging-dir
        arg: dir
        help: Override image logging directory
      - long: --web-server-share-dir
        arg: dir
        help: Override web share directory
      - long: --e6-host-address
        arg: host
        help: E6 simulator host address
      - long: --gspro-host-address
        arg: host
        help: GSPro simulator host address

  - name: stop
    help: Stop PiTrac launch monitor
    examples:
      - pitrac stop
      - pitrac stop --force
    flags:
      - long: --force
        short: -f
        help: Force stop (SIGKILL instead of SIGTERM)
      - long: --timeout
        arg: seconds
        help: Timeout before force stopping
        default: "5"

  - name: status
    help: Show PiTrac system status
    examples:
      - pitrac status
      - pitrac status --json
    flags:
      - long: --json
        help: Output in JSON format
      - long: --services
        help: Include service status

  - name: setup
    help: Run initial setup wizard
    examples:
      - pitrac setup
      - pitrac setup --pi-model pi5
    flags:
      - long: --pi-model
        arg: model
        help: Specify Pi model
        allowed: [pi4, pi5, auto]
        default: auto
      - long: --skip-reboot
        help: Don't prompt for reboot after setup

  # Camera management
  - name: camera
    alias: cam
    help: Camera operations
    commands:
      - name: list
        help: List available cameras
        flags:
          - long: --detailed
            help: Show detailed information

      - name: test
        help: Test camera capture
        args:
          - name: duration
            help: Test duration in seconds
            default: "5"
        flags:
          - long: --camera
            arg: slot
            help: Camera slot (1 or 2)
            allowed: ["1", "2"]

      - name: trigger
        help: Set camera trigger mode
        args:
          - name: mode
            help: Trigger mode
            required: true
            allowed: [internal, external]
        flags:
          - long: --camera
            arg: slot
            help: Camera slot (1 or 2)
            allowed: ["1", "2"]

      - name: config
        help: Camera configuration
        commands:
          - name: timeout
            help: Set camera timeout
            args:
              - name: milliseconds
                help: Timeout in milliseconds
                required: true

  # Calibration commands
  - name: calibrate
    alias: cal
    help: Camera calibration
    examples:
      - pitrac calibrate camera --slot 1
      - pitrac calibrate auto --slot 2
    commands:
      - name: camera
        help: Manual camera calibration
        args:
          - name: slot
            help: Camera slot (1 or 2)
            required: true
            allowed: ["1", "2"]
        flags:
          - long: --interactive
            help: Interactive calibration mode

      - name: auto
        help: Automatic calibration
        args:
          - name: slot
            help: Camera slot (1 or 2)
            required: true
            allowed: ["1", "2"]

      - name: wizard
        help: Calibration wizard

  # External service management
  - name: web
    help: Manage PiTrac web server
    args:
      - name: action
        help: Action to perform
        required: true
        allowed: [start, stop, restart, status, logs, url]
    flags:
      - long: --follow
        short: -f
        help: Follow logs (with 'logs' action)


  - name: activemq
    alias: amq
    help: Manage ActiveMQ broker
    args:
      - name: action
        help: Action to perform
        required: true
        allowed: [start, stop, restart, status, logs, console, port]
    flags:
      - long: --follow
        short: -f
        help: Follow logs (with 'logs' action)

  # Log viewing
  - name: logs
    help: View PiTrac logs
    examples:
      - pitrac logs
      - pitrac logs --follow
      - pitrac logs --tail 100
    flags:
      - long: --follow
        short: -f
        help: Follow log output
      - long: --tail
        short: -n
        arg: lines
        help: Number of lines to show
        default: "50"
      - long: --service
        help: Show service logs instead
      - long: --all
        help: Show all available logs

  # Boot configuration
  - name: boot
    help: Boot configuration helper
    commands:
      - name: config
        help: Show boot configuration requirements
        args:
          - name: model
            help: Pi model
            default: auto
            allowed: [pi4, pi5, auto]

  # Help and version (built-in, but customizable)
  - name: version
    help: Show version information
    flags:
      - long: --build
        help: Include build information

# Dependencies check - these are checked at runtime
dependencies:
  - bash
  - grep
  - sed